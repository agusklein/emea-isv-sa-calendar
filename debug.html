<!DOCTYPE html>
<html>
<head>
    <title>Debug Calendar Events</title>
</head>
<body>
    <h1>Debug Calendar Events</h1>
    <div id="output"></div>

    <script>
        const SHEET_URL = 'https://docs.google.com/spreadsheets/d/1DOlgJyYL7w_p1kR4IKjHvn7E8Cw31YWKZ2WOt-b_aJs/gviz/tq?tqx=out:json&sheet=Sheet1';
        
        function parseMonthFromSheet(monthValue) {
            if (typeof monthValue === 'string') {
                const monthStr = monthValue.toLowerCase().trim();
                const monthNames = [
                    'january', 'february', 'march', 'april', 'may', 'june',
                    'july', 'august', 'september', 'october', 'november', 'december'
                ];
                
                for (let i = 0; i < monthNames.length; i++) {
                    if (monthStr.includes(monthNames[i])) {
                        return i;
                    }
                }
            }
            return null;
        }

        function parseYearFromSheet(dateValue) {
            if (typeof dateValue === 'string') {
                const yearMatch = dateValue.match(/\b(20\d{2})\b/);
                if (yearMatch) {
                    return parseInt(yearMatch[1]);
                }
            }
            return 2025;
        }

        async function testParsing() {
            try {
                const response = await fetch(SHEET_URL);
                const text = await response.text();
                const jsonString = text.substring(47).slice(0, -2);
                const data = JSON.parse(jsonString);
                
                const events = [];
                const rows = data.table.rows;
                
                for (let i = 0; i < rows.length; i++) {
                    const row = rows[i];
                    if (!row.c || row.c.length < 2) continue;
                    
                    const titleCell = row.c[2];
                    const whenCell = row.c[3];
                    const descriptionCell = row.c[4];
                    
                    const event = {
                        title: titleCell ? titleCell.v : '',
                        when: whenCell ? whenCell.v : '',
                        month: whenCell ? parseMonthFromSheet(whenCell.v) : null,
                        year: whenCell ? parseYearFromSheet(whenCell.v) : 2025,
                        description: descriptionCell ? descriptionCell.v : ''
                    };
                    
                    if (event.month !== null && event.title) {
                        events.push(event);
                    }
                }
                
                // Filter September 2025 events
                const sep2025Events = events.filter(e => e.month === 8 && e.year === 2025);
                
                document.getElementById('output').innerHTML = `
                    <h2>Total Events: ${events.length}</h2>
                    <h2>September 2025 Events: ${sep2025Events.length}</h2>
                    <pre>${JSON.stringify(sep2025Events, null, 2)}</pre>
                `;
                
            } catch (error) {
                document.getElementById('output').innerHTML = `Error: ${error.message}`;
            }
        }
        
        testParsing();
    </script>
</body>
</html>

// 🤖 AUTO-GENERATED DATA - Last updated: 2025-08-25T15:05:37.562Z
// Source: Manual Google Sheets Sync
// Events: 37 events loaded from spreadsheet
const STATIC_EVENTS = [
  {
    "date": "2025-09-15",
    "title": "OP2 Prep",
    "description": "Start preparing by beginning of September",
    "type": "meeting",
    "location": "",
    "month": 8,
    "year": 2025,
    "originalWhen": "September 2025"
  },
  {
    "date": "2025-09-15",
    "title": "AWSome Awards Nominations Review",
    "description": "To be done in the last month of each quarter",
    "type": "meeting",
    "location": "",
    "month": 8,
    "year": 2025,
    "originalWhen": "September 2025"
  },
  {
    "date": "2025-09-15",
    "title": "Resource Allocation Review",
    "description": "To check SAs assignation of accounts and HC split per area",
    "type": "meeting",
    "location": "",
    "month": 8,
    "year": 2025,
    "originalWhen": "September 2025"
  },
  {
    "date": "2025-11-15",
    "title": "OP2",
    "description": "To be delivered in November",
    "type": "meeting",
    "location": "",
    "month": 10,
    "year": 2025,
    "originalWhen": "November 2025"
  },
  {
    "date": "2025-12-15",
    "title": "OLR Prep",
    "description": "At least 1 month before OLR",
    "type": "meeting",
    "location": "",
    "month": 11,
    "year": 2025,
    "originalWhen": "December 2025"
  },
  {
    "date": "2025-12-15",
    "title": "AWSome Awards Nominations Review",
    "description": "To be done in the last month of each quarter",
    "type": "meeting",
    "location": "",
    "month": 11,
    "year": 2025,
    "originalWhen": "December 2025"
  },
  {
    "date": "2025-12-15",
    "title": "Re:Invent (1-week Event)",
    "description": "",
    "type": "meeting",
    "location": "",
    "month": 11,
    "year": 2025,
    "originalWhen": "December 2025"
  },
  {
    "date": "2025-12-15",
    "title": "Post Re:Invent (Re-Caps)",
    "description": "Mid-December after the event",
    "type": "meeting",
    "location": "",
    "month": 11,
    "year": 2025,
    "originalWhen": "December 2025"
  },
  {
    "date": "2025-12-15",
    "title": "Resource Allocation Review",
    "description": "To check SAs assignation of accounts and HC split per area",
    "type": "meeting",
    "location": "",
    "month": 11,
    "year": 2025,
    "originalWhen": "December 2025"
  },
  {
    "date": "2026-01-15",
    "title": "H2 Retrospective of each area",
    "description": "To be reviewed during the offsite",
    "type": "meeting",
    "location": "",
    "month": 0,
    "year": 2026,
    "originalWhen": "January 2026"
  },
  {
    "date": "2026-01-15",
    "title": "EMEA ISV Managers Offsite",
    "description": "Happening at the end of the month or beginning of Feb",
    "type": "meeting",
    "location": "",
    "month": 0,
    "year": 2026,
    "originalWhen": "January 2026"
  },
  {
    "date": "2026-02-15",
    "title": "Technical Account Plans",
    "description": "",
    "type": "meeting",
    "location": "",
    "month": 1,
    "year": 2026,
    "originalWhen": "February 2026"
  },
  {
    "date": "2026-03-15",
    "title": "AWS Summits per Area",
    "description": "Identification and Mapping of all the summits",
    "type": "meeting",
    "location": "",
    "month": 2,
    "year": 2026,
    "originalWhen": "March 2026"
  },
  {
    "date": "2026-03-15",
    "title": "AWSome Awards Nominations Review",
    "description": "To be done in the last month of each quarter",
    "type": "meeting",
    "location": "",
    "month": 2,
    "year": 2026,
    "originalWhen": "March 2026"
  },
  {
    "date": "2026-03-15",
    "title": "Resource Allocation Review",
    "description": "To check SAs assignation of accounts and HC split per area",
    "type": "meeting",
    "location": "",
    "month": 2,
    "year": 2026,
    "originalWhen": "March 2026"
  },
  {
    "date": "2026-04-15",
    "title": "OP1 Prep",
    "description": "Start preparing by mid of April",
    "type": "meeting",
    "location": "",
    "month": 3,
    "year": 2026,
    "originalWhen": "April 2026"
  },
  {
    "date": "2026-04-15",
    "title": "ISV SA QBR",
    "description": "",
    "type": "meeting",
    "location": "",
    "month": 3,
    "year": 2026,
    "originalWhen": "April 2026"
  },
  {
    "date": "2026-05-15",
    "title": "Re:Invent (Preparation, STO)",
    "description": "Identify STO and work on the following months",
    "type": "meeting",
    "location": "",
    "month": 4,
    "year": 2026,
    "originalWhen": "May 2026"
  },
  {
    "date": "2026-06-15",
    "title": "EMEA ISV Managers Offsite",
    "description": "",
    "type": "meeting",
    "location": "",
    "month": 5,
    "year": 2026,
    "originalWhen": "June 2026"
  },
  {
    "date": "2026-06-15",
    "title": "H1 Retrospective of each area",
    "description": "To be reviewed during the offsite",
    "type": "meeting",
    "location": "",
    "month": 5,
    "year": 2026,
    "originalWhen": "June 2026"
  },
  {
    "date": "2026-06-15",
    "title": "OP1",
    "description": "To be delivered in June",
    "type": "meeting",
    "location": "",
    "month": 5,
    "year": 2026,
    "originalWhen": "June 2026"
  },
  {
    "date": "2026-06-15",
    "title": "OLR Prep",
    "description": "At least 1 month before OLR",
    "type": "meeting",
    "location": "",
    "month": 5,
    "year": 2026,
    "originalWhen": "June 2026"
  },
  {
    "date": "2026-06-15",
    "title": "AWSome Awards Nominations Review",
    "description": "To be done in the last month of each quarter",
    "type": "meeting",
    "location": "",
    "month": 5,
    "year": 2026,
    "originalWhen": "June 2026"
  },
  {
    "date": "2026-07-15",
    "title": "OLR (Johan's Level)",
    "description": "After this Johan needs to participate in Miguel's OLR",
    "type": "meeting",
    "location": "",
    "month": 6,
    "year": 2026,
    "originalWhen": "July 2026"
  },
  {
    "date": "2026-07-15",
    "title": "ISV SA QBR",
    "description": "",
    "type": "meeting",
    "location": "",
    "month": 6,
    "year": 2026,
    "originalWhen": "July 2026"
  },
  {
    "date": "2026-07-15",
    "title": "Review Technical Account Plans",
    "description": "Check during the middle of the year to see progression and adjustment",
    "type": "meeting",
    "location": "",
    "month": 6,
    "year": 2026,
    "originalWhen": "July 2026"
  },
  {
    "date": "2026-07-15",
    "title": "Resource Allocation Review",
    "description": "To check SAs assignation of accounts and HC split per area",
    "type": "meeting",
    "location": "",
    "month": 6,
    "year": 2026,
    "originalWhen": "July 2026"
  },
  {
    "date": "2026-09-15",
    "title": "OP2 Prep",
    "description": "To be delivered in November",
    "type": "meeting",
    "location": "",
    "month": 8,
    "year": 2026,
    "originalWhen": "September 2026"
  },
  {
    "date": "2026-09-15",
    "title": "AWSome Awards Nominations Review",
    "description": "To be done in the last month of each quarter",
    "type": "meeting",
    "location": "",
    "month": 8,
    "year": 2026,
    "originalWhen": "September 2026"
  },
  {
    "date": "2026-09-15",
    "title": "Resource Allocation Review",
    "description": "To check SAs assignation of accounts and HC split per area",
    "type": "meeting",
    "location": "",
    "month": 8,
    "year": 2026,
    "originalWhen": "September 2026"
  },
  {
    "date": "2026-10-15",
    "title": "ISV SA QBR",
    "description": "",
    "type": "meeting",
    "location": "",
    "month": 9,
    "year": 2026,
    "originalWhen": "October 2026"
  },
  {
    "date": "2026-11-15",
    "title": "OP2",
    "description": "To be delivered in November",
    "type": "meeting",
    "location": "",
    "month": 10,
    "year": 2026,
    "originalWhen": "November 2026"
  },
  {
    "date": "2026-12-15",
    "title": "OLR Prep",
    "description": "At least 1 month before OLR",
    "type": "meeting",
    "location": "",
    "month": 11,
    "year": 2026,
    "originalWhen": "December 2026"
  },
  {
    "date": "2026-12-15",
    "title": "AWSome Awards Nominations Review",
    "description": "To be done in the last month of each quarter",
    "type": "meeting",
    "location": "",
    "month": 11,
    "year": 2026,
    "originalWhen": "December 2026"
  },
  {
    "date": "2026-12-15",
    "title": "Re:Invent (1-week Event)",
    "description": "",
    "type": "meeting",
    "location": "",
    "month": 11,
    "year": 2026,
    "originalWhen": "December 2026"
  },
  {
    "date": "2026-12-15",
    "title": "Post Re:Invent (Re-Caps)",
    "description": "Mid-December after the event",
    "type": "meeting",
    "location": "",
    "month": 11,
    "year": 2026,
    "originalWhen": "December 2026"
  },
  {
    "date": "2026-12-15",
    "title": "Resource Allocation Review",
    "description": "To check SAs assignation of accounts and HC split per area",
    "type": "meeting",
    "location": "",
    "month": 11,
    "year": 2026,
    "originalWhen": "December 2026"
  }
];
const LAST_SHEETS_UPDATE = '2025-08-25T15:05:37.562Z';

// Global variables
let currentYear = 2025;
let recurringEvents = []; // Changed from events to recurringEvents
let generatedEvents = []; // All events generated for display

// Google Sheets configuration
const SHEET_ID = '1DOlgJyYL7w_p1kR4IKjHvn7E8Cw31YWKZ2WOt-b_aJs';
const SHEET_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=Sheet1`;

// Initialize the application
document.addEventListener('DOMContentLoaded', function() {
    console.log('Initializing EMEA ISV SA Managers Annual Clock...');
    initializeCalendarControls();
    loadEventsFromSheet();
});

// Calendar controls
function initializeCalendarControls() {
    const prevYearBtn = document.getElementById('prevYear');
    const nextYearBtn = document.getElementById('nextYear');
    const yearDisplay = document.getElementById('currentYear');

    prevYearBtn.addEventListener('click', () => {
        currentYear--;
        yearDisplay.textContent = currentYear;
        displayUpcomingEvents();
        generateCalendar();
    });

    nextYearBtn.addEventListener('click', () => {
        currentYear++;
        yearDisplay.textContent = currentYear;
        displayUpcomingEvents();
        generateCalendar();
    });
}

// Load events from Google Sheets (with fallback to static data)
async function loadEventsFromSheet() {
    console.log('Loading events from Google Sheets...');
    showLoadingState();
    
    try {
        const response = await fetch(SHEET_URL);
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const text = await response.text();
        console.log('Raw response received from Google Sheets');
        
        // Parse Google Sheets JSON response
        const jsonString = text.substring(47).slice(0, -2);
        const data = JSON.parse(jsonString);
        
        const events = parseSheetData(data);
        console.log(`Successfully loaded ${events.length} events from Google Sheets:`, events);
        
        // Set the global variables with the loaded data
        generatedEvents = events.map(event => ({
            ...event,
            date: `${event.year}-${String(event.month + 1).padStart(2, '0')}-15` // Use 15th of month as default
        }));
        
        console.log('FINAL generatedEvents after mapping:', generatedEvents);
        console.log('September 2025 events in generatedEvents:', generatedEvents.filter(e => e.month === 8 && e.year === 2025));
        
        // Also create recurring events structure for calendar display
        recurringEvents = events;
        
        displayUpcomingEvents();
        generateCalendar();
        
        // Force a second calendar generation after a short delay to ensure events are displayed
        setTimeout(() => {
            console.log('Force refreshing calendar after event load...');
            generateCalendar();
        }, 100);
        
    } catch (error) {
        console.error('Error loading events from Google Sheets:', error);
        console.log('Falling back to static data from last monthly sync...');
        loadSampleRecurringEvents();
    }
}

// Parse Google Sheets data for recurring events
function parseSheetData(data) {
    console.log('Parsing Google Sheets data for recurring events:', data);
    
    if (!data.table || !data.table.rows) {
        console.error('Invalid data structure from Google Sheets');
        return [];
    }
    
    const rows = data.table.rows;
    const parsedRecurringEvents = [];
    
    console.log(`Processing ${rows.length} rows from spreadsheet`);
    
    // Skip header row (index 0) and process data rows
    for (let i = 1; i < rows.length; i++) {
        const row = rows[i];
        
        if (!row.c || row.c.length < 2) {
            console.log(`Skipping row ${i}: insufficient data`);
            continue;
        }
        
        // Extract data from each column based on actual spreadsheet structure
        // Column A (0): Empty, Column B (1): Number, Column C (2): Activity, Column D (3): When?, Column E (4): Comments, Column F (5): Empty
        const numberCell = row.c[1];
        const titleCell = row.c[2];
        const whenCell = row.c[3];
        const descriptionCell = row.c[4];
        
        const recurringEvent = {
            month: whenCell ? parseMonthFromSheet(whenCell.v) : null,
            title: titleCell ? titleCell.v : '',
            description: descriptionCell ? descriptionCell.v : '',
            type: 'meeting', // Default type since not in spreadsheet
            location: '',
            year: whenCell ? parseYearFromSheet(whenCell.v) : 2025,
            originalWhen: whenCell ? whenCell.v : ''
        };
        
        console.log(`Row ${i}:`, recurringEvent);
        
        // Debug OP2 Prep specifically
        if (recurringEvent.title && recurringEvent.title.includes('OP2 Prep')) {
            console.log('FOUND OP2 PREP:', recurringEvent);
        }
        
        // Only add events with valid month and title
        if (recurringEvent.month !== null && recurringEvent.title && recurringEvent.title.trim() !== '') {
            parsedRecurringEvents.push(recurringEvent);
            console.log(`Added recurring event: ${recurringEvent.title} in ${getMonthName(recurringEvent.month)}`);
        } else {
            console.log(`Skipped row ${i}: missing month or title`);
        }
    }
    
    console.log('Final recurring events:', parsedRecurringEvents);
    return parsedRecurringEvents;
}

// Parse month from Google Sheets (handles "Month YYYY" format)
function parseMonthFromSheet(monthValue) {
    console.log('Parsing month value:', monthValue, typeof monthValue);
    
    if (typeof monthValue === 'string') {
        const monthStr = monthValue.toLowerCase().trim();
        const monthNames = [
            'january', 'february', 'march', 'april', 'may', 'june',
            'july', 'august', 'september', 'october', 'november', 'december'
        ];
        
        // Try to find month name in "Month YYYY" format
        for (let i = 0; i < monthNames.length; i++) {
            if (monthStr.includes(monthNames[i])) {
                console.log(`Parsed month name "${monthValue}" to month ${i}`);
                return i;
            }
        }
        
        // Try to parse as number
        const monthNum = parseInt(monthStr);
        if (!isNaN(monthNum) && monthNum >= 1 && monthNum <= 12) {
            console.log(`Parsed month number "${monthValue}" to month ${monthNum - 1}`);
            return monthNum - 1; // Convert to 0-based index
        }
    } else if (typeof monthValue === 'number') {
        if (monthValue >= 1 && monthValue <= 12) {
            console.log(`Parsed numeric month ${monthValue} to month ${monthValue - 1}`);
            return monthValue - 1; // Convert to 0-based index
        }
    }
    
    console.log('Could not parse month value:', monthValue);
    return null;
}

// Parse year from Google Sheets (handles "Month YYYY" format)
function parseYearFromSheet(dateValue) {
    console.log('Parsing year from:', dateValue);
    
    if (typeof dateValue === 'string') {
        const yearMatch = dateValue.match(/\b(20\d{2})\b/);
        if (yearMatch) {
            const year = parseInt(yearMatch[1]);
            console.log(`Parsed year ${year} from "${dateValue}"`);
            return year;
        }
    }
    
    console.log('Could not parse year, defaulting to 2025');
    return 2025; // Default year
}

// Generate events for display based on recurring events
function generateEventsForDisplay() {
    console.log('Generating events for display...');
    generatedEvents = [];
    
    // Generate events for current year and next year
    const yearsToGenerate = [currentYear, currentYear + 1];
    
    yearsToGenerate.forEach(year => {
        recurringEvents.forEach(recurringEvent => {
            // Create an event for this year and month
            const event = {
                date: `${year}-${String(recurringEvent.month + 1).padStart(2, '0')}-15`, // Use 15th as default day
                title: recurringEvent.title,
                description: recurringEvent.description,
                type: recurringEvent.type,
                location: recurringEvent.location,
                month: recurringEvent.month,
                year: year
            };
            
            generatedEvents.push(event);
        });
    });
    
    // Sort by date
    generatedEvents.sort((a, b) => new Date(a.date) - new Date(b.date));
    console.log(`Generated ${generatedEvents.length} events for display:`, generatedEvents);
}

// Get month name from index
function getMonthName(monthIndex) {
    const monthNames = [
        'January', 'February', 'March', 'April', 'May', 'June',
        'July', 'August', 'September', 'October', 'November', 'December'
    ];
    return monthNames[monthIndex];
}

// Load events from static data (updated from Google Sheets)
function loadSampleRecurringEvents() {
    console.log('Loading static events from last Google Sheets sync...');
    console.log('Last updated:', LAST_SHEETS_UPDATE);
    
    if (typeof STATIC_EVENTS !== 'undefined' && STATIC_EVENTS.length > 0) {
        // Convert static events to the format expected by the website
        generatedEvents = STATIC_EVENTS;
        console.log(`Loaded ${generatedEvents.length} static events from sheets sync`);
        
        // Also create recurring events structure for calendar display
        recurringEvents = [];
        const monthGroups = {};
        
        STATIC_EVENTS.forEach(event => {
            const monthKey = event.month;
            if (!monthGroups[monthKey]) {
                monthGroups[monthKey] = [];
            }
            monthGroups[monthKey].push(event);
        });
        
        // Create recurring events for calendar display
        Object.keys(monthGroups).forEach(monthKey => {
            const month = parseInt(monthKey);
            const eventsInMonth = monthGroups[monthKey];
            
            eventsInMonth.forEach(event => {
                recurringEvents.push({
                    month: month,
                    title: event.title,
                    description: event.description,
                    type: event.type,
                    location: event.location,
                    year: event.year,
                    originalWhen: event.originalWhen
                });
            });
        });
        
    } else {
        // Ultimate fallback if no static data available
        generatedEvents = [
            {
                date: '2025-09-15',
                title: 'Sample Event - September 2025',
                description: 'This is a sample event',
                type: 'meeting',
                location: 'Virtual',
                month: 8,
                year: 2025
            }
        ];
        recurringEvents = [
            {
                month: 8,
                title: 'Sample Event - September 2025',
                description: 'This is a sample event',
                type: 'meeting',
                location: 'Virtual'
            }
        ];
        console.log('Using ultimate fallback sample data');
    }
    
    displayUpcomingEvents();
    generateCalendar();
}

// Display upcoming events (next 90 days)
function displayUpcomingEvents() {
    console.log('Displaying upcoming events...');
    const today = new Date();
    const next90Days = new Date(today.getTime() + (90 * 24 * 60 * 60 * 1000));
    
    const upcomingEvents = generatedEvents.filter(event => {
        const eventDate = new Date(event.date);
        return eventDate >= today && eventDate <= next90Days;
    });
    
    console.log(`Found ${upcomingEvents.length} upcoming events in next 90 days:`, upcomingEvents);
    
    const container = document.getElementById('upcomingEventsGrid');
    const noEventsMessage = document.getElementById('noEventsMessage');
    
    if (upcomingEvents.length === 0) {
        container.innerHTML = '';
        container.style.display = 'none';
        noEventsMessage.style.display = 'block';
        return;
    }
    
    container.style.display = 'grid';
    noEventsMessage.style.display = 'none';
    
    container.innerHTML = upcomingEvents.map(event => {
        const eventDate = new Date(event.date);
        const daysUntil = Math.ceil((eventDate - today) / (1000 * 60 * 60 * 24));
        
        return `
            <div class="event-card">
                <div class="event-date">
                    ${getMonthName(event.month)} ${event.year} ${daysUntil > 0 ? `(in ~${daysUntil} days)` : daysUntil === 0 ? '(This month)' : ''}
                </div>
                <div class="event-title">${event.title}</div>
                <div class="event-description">${event.description}</div>
                ${event.location ? `<div class="event-location">📍 ${event.location}</div>` : ''}
                <div class="event-type">${capitalizeFirst(event.type)}</div>
            </div>
        `;
    }).join('');
}

// Generate calendar with monthly view
function generateCalendar() {
    console.log(`Generating calendar for year ${currentYear}...`);
    
    // Ensure we have events loaded
    if (generatedEvents.length === 0 && typeof STATIC_EVENTS !== 'undefined') {
        console.log('No events loaded, using static events for calendar');
        generatedEvents = STATIC_EVENTS;
    }
    
    const container = document.getElementById('monthsList');
    const startMonth = currentYear === 2025 ? 7 : 0; // Start from August 2025 (month 7)
    const endMonth = 11; // Always end at December
    
    container.innerHTML = '';
    container.className = 'months-grid'; // Change to grid layout
    
    for (let month = startMonth; month <= endMonth; month++) {
        const monthCard = createMonthCard(currentYear, month);
        container.appendChild(monthCard);
    }
}

// Create individual month card (updated for grid layout)
function createMonthCard(year, month) {
    const monthNames = [
        'January', 'February', 'March', 'April', 'May', 'June',
        'July', 'August', 'September', 'October', 'November', 'December'
    ];
    
    const monthCard = document.createElement('div');
    monthCard.className = 'month-card';
    
    // Month header
    const header = document.createElement('div');
    header.className = 'month-header';
    header.textContent = `${monthNames[month]} ${year}`;
    monthCard.appendChild(header);
    
    // Get events for this month and year
    const monthEvents = generatedEvents.filter(event => {
        const eventDate = new Date(event.date);
        return eventDate.getFullYear() === year && eventDate.getMonth() === month;
    });
    
    console.log(`${monthNames[month]} ${year}: Found ${monthEvents.length} events`, monthEvents);
    
    // Debug September 2025 specifically
    if (month === 8 && year === 2025) {
        console.log('DEBUG: September 2025 - All generatedEvents:', generatedEvents);
        console.log('DEBUG: September 2025 - Filtered events:', monthEvents);
    }
    
    // Month events container
    const eventsContainer = document.createElement('div');
    eventsContainer.className = 'month-events';
    
    if (monthEvents.length === 0) {
        const noEvents = document.createElement('div');
        noEvents.className = 'no-events-month';
        noEvents.textContent = 'No events scheduled';
        eventsContainer.appendChild(noEvents);
    } else {
        // Sort events by date within the month
        monthEvents.sort((a, b) => new Date(a.date) - new Date(b.date));
        
        monthEvents.forEach(event => {
            const eventElement = createMonthEventElement(event);
            eventsContainer.appendChild(eventElement);
        });
    }
    
    monthCard.appendChild(eventsContainer);
    return monthCard;
}

// Create individual event element for month view (updated for grid layout)
function createMonthEventElement(event) {
    const eventDiv = document.createElement('div');
    eventDiv.className = 'month-event';
    
    // Extract year from the event
    const eventYear = event.year || new Date(event.date).getFullYear();
    
    eventDiv.innerHTML = `
        <div class="event-date-day">
            <span class="day">${eventYear}</span>
            <span class="weekday">${getMonthName(event.month).substring(0, 3)}</span>
        </div>
        <div class="event-details">
            <div class="title">${event.title}</div>
            <div class="description">${event.description}</div>
            <div class="meta">
                ${event.location ? `<span>📍 ${event.location}</span>` : ''}
            </div>
        </div>
    `;
    
    return eventDiv;
}

// Utility functions
function formatDate(dateString) {
    const date = new Date(dateString);
    const options = { 
        weekday: 'long', 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric' 
    };
    return date.toLocaleDateString('en-US', options);
}

function capitalizeFirst(str) {
    return str.charAt(0).toUpperCase() + str.slice(1);
}

// Show loading state
function showLoadingState() {
    const upcomingContainer = document.getElementById('upcomingEventsGrid');
    const calendarContainer = document.getElementById('monthsList');
    
    upcomingContainer.innerHTML = '<div class="loading-spinner">Loading recurring events from Google Sheets...</div>';
    calendarContainer.innerHTML = '<div class="loading-spinner">Loading calendar from Google Sheets...</div>';
}

// Refresh data periodically (every 10 minutes)
setInterval(() => {
    console.log('Refreshing recurring events data...');
    loadEventsFromSheet();
}, 10 * 60 * 1000);
